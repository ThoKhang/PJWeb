@model List<WEBNC.Models.SanPham>

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Qu·∫£n l√Ω s·∫£n ph·∫©m";
    var q = ViewBag.Q as string;

    int total = Model?.Count ?? 0;
    int low = Model?.Count(x => x.soLuongHienCon > 0 && x.soLuongHienCon <= x.soLuongCanDuoi) ?? 0;
    int outS = Model?.Count(x => x.soLuongHienCon <= 0) ?? 0;
}

<div class="admin-card p-3 p-lg-4">
    <div class="d-flex flex-wrap justify-content-between align-items-center gap-2 mb-3">
        <div>
            <div class="fw-bold fs-3">Qu·∫£n l√Ω s·∫£n ph·∫©m</div>
            <div class="text-muted" style="color: var(--muted) !important;">
                Danh s√°ch / t√¨m ki·∫øm / c·∫≠p nh·∫≠t t·ªìn kho &amp; gi√°
            </div>
        </div>

        <div class="d-flex flex-wrap gap-2">
            <form method="get" class="d-flex gap-2">
                <input name="q" value="@q" class="form-control input-admin" style="min-width:300px"
                       placeholder="T√¨m m√£ / t√™n / c√¥ng ty / lo·∫°i..." />
                <button class="btn btn-mini" type="submit">T√¨m</button>
            </form>

            <a class="btn btn-brand"
               asp-area="Admin" asp-controller="SanPham" asp-action="Create">
                + Th√™m m·ªõi
            </a>
        </div>
    </div>

    <div class="row g-3 mb-3">
        <div class="col-12 col-lg-4">
            <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">T·ªïng s·∫£n ph·∫©m</div>
                    <div class="fw-bold fs-3">@total</div>
                </div>
                <span class="pill pill-ok">Danh s√°ch</span>
            </div>
        </div>

        <div class="col-12 col-lg-4">
            <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">S·∫Øp h·∫øt h√†ng</div>
                    <div class="fw-bold fs-3">@low</div>
                </div>
                <span class="pill pill-warn">C·∫£nh b√°o</span>
            </div>
        </div>

        <div class="col-12 col-lg-4">
            <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
                <div>
                    <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">H·∫øt h√†ng</div>
                    <div class="fw-bold fs-3">@outS</div>
                </div>
                <span class="pill pill-danger">Stop</span>
            </div>
        </div>
    </div>

    <div class="table-wrap">
        <table class="table table-admin align-middle">
            <thead>
                <tr>
                    <th style="width:78px">·∫¢nh</th>
                    <th style="width:110px">M√£</th>
                    <th>T√™n</th>
                    <th style="width:160px">C√¥ng ty</th>
                    <th style="width:160px">Lo·∫°i</th>
                    <th class="text-end" style="width:140px">Gi√°</th>
                    <th class="text-center" style="width:160px">T·ªìn kho</th>
                    <th class="text-end" style="width:220px">Thao t√°c</th>
                </tr>
            </thead>

            <tbody>
                @foreach (var sp in Model)
                {
                    bool isOut = sp.soLuongHienCon <= 0;
                    bool isLow = !isOut && sp.soLuongHienCon <= sp.soLuongCanDuoi;

                    string statusClass = isOut ? "bad" : (isLow ? "warn" : "ok");
                    string statusText = isOut ? "H·∫øt h√†ng" : (isLow ? "S·∫Øp h·∫øt" : "C√≤n h√†ng");

                    <tr>
                        <td>
                            <img class="thumb"
                                 src="@(string.IsNullOrWhiteSpace(sp.imageURL) ? "/images/noimage.png" : "/images/" + sp.imageURL)"
                                 onerror="this.src='/images/noimage.png';" />
                        </td>

                        <td>
                            <span class="badge-soft">@sp.idSanPham</span>
                        </td>

                        <td>
                            <div class="fw-bold">@sp.tenSanPham</div>
                            <div class="text-muted" style="color:var(--muted)!important;font-size:12px;">
                                SL c·∫£nh b√°o: @sp.soLuongCanDuoi
                            </div>
                        </td>

                        <td>@sp.congTy?.tenCongTy</td>
                        <td>@sp.LoaiSanPham?.tenLoaiSanPham</td>

                        <td class="text-end fw-bold">@string.Format("{0:N0}", sp.gia)</td>

                        <td class="text-center">
                            <div class="status @statusClass">
                                <span>‚óè</span> @statusText
                            </div>
                            <div class="text-muted" style="color:var(--muted)!important;font-size:12px;">
                                @sp.soLuongHienCon
                            </div>
                        </td>

                        <td class="text-end">
                            <a class="btn btn-mini me-1"
                               asp-area="Admin" asp-controller="SanPham" asp-action="Edit" asp-route-id="@sp.idSanPham">
                                ‚úèÔ∏è S·ª≠a
                            </a>
                            <a class="btn btn-mini btn-mini-danger"
                               asp-area="Admin" asp-controller="SanPham" asp-action="Delete" asp-route-id="@sp.idSanPham">
                                üóëÔ∏è X√≥a
                            </a>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
