@model List<WEBNC.Models.SanPham>

@{
    Layout = "~/Areas/Admin/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Quản lý sản phẩm";
    var q = ViewBag.Q as string;

    int total = Model?.Count ?? 0;
    int low = Model?.Count(x => x.soLuongHienCon > 0 && x.soLuongHienCon <= x.soLuongCanDuoi) ?? 0;
    int outS = Model?.Count(x => x.soLuongHienCon <= 0) ?? 0;
}

@section Styles {
    <link rel="stylesheet"
          href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" />
}

<!-- HEADER CARD -->
<div class="admin-card p-3 mb-4 d-flex align-items-center justify-content-between flex-wrap gap-3">
    <div>
        <div class="crumb mb-1" style="font-size:12px;">
            Sản phẩm • Danh sách
        </div>
        <h2 class="mb-1" style="font-weight:700; font-size:24px;">
            Quản lý sản phẩm
        </h2>
        <div class="text-muted" style="font-size:13px;">
            Xem, thêm mới, chỉnh sửa và xóa sản phẩm trong hệ thống.
        </div>
    </div>

    <div class="d-flex align-items-center gap-2 flex-wrap">
        <button class="btn-mini" type="button" id="btnRefreshProduct">
            <i class="fa-solid fa-rotate me-1"></i> Làm mới
        </button>

        <a class="btn btn-brand" href="/Admin/SanPham/Create">
            <i class="fa-solid fa-plus me-1"></i> Thêm sản phẩm
        </a>
    </div>
</div>

<!-- THỐNG KÊ NHANH THEO TỒN KHO -->
<div class="row g-3 mb-3">
    <div class="col-12 col-lg-4">
        <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
            <div>
                <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">
                    Tổng sản phẩm
                </div>
                <div class="fw-bold fs-3">@total</div>
            </div>
            <span class="pill pill-ok">Danh sách</span>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
            <div>
                <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">
                    Sắp hết hàng
                </div>
                <div class="fw-bold fs-3">@low</div>
            </div>
            <span class="pill pill-warn">Cảnh báo</span>
        </div>
    </div>

    <div class="col-12 col-lg-4">
        <div class="admin-card soft p-3 d-flex align-items-center justify-content-between">
            <div>
                <div class="text-muted" style="color:var(--muted)!important;font-weight:700;">
                    Hết hàng
                </div>
                <div class="fw-bold fs-3">@outS</div>
            </div>
            <span class="pill pill-danger">Stop</span>
        </div>
    </div>
</div>

<!-- BẢNG SẢN PHẨM (DataTables fill bằng JS) -->
<div class="admin-card p-2">
    <div class="table-wrap">
        <table id="tblSanPham"
               class="table-admin display nowrap"
               style="width:100%">
            <thead>
                <tr>
                    <th>Mã SP</th>
                    <th>Sản phẩm</th>
                    <th>Hình ảnh</th>
                    <th>Loại</th>
                    <th>Công ty</th>
                    <th>Giá</th>
                    <th>Tồn kho</th>
                    <th style="min-width:130px;">Thao tác</th>
                </tr>
            </thead>
            <tbody>
                @* DataTables + sanpham.page.js sẽ fill bằng AJAX *@
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script type="module" src="~/js/pages/sanpham.page.js"></script>

    <script>
        document.getElementById("btnRefreshProduct")
            ?.addEventListener("click", () => location.reload());
    </script>
}
